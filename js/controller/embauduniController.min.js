var arrCondTran=[],Embauduni=function(){function a(){x$("#tbody_condiciones").html("");var a,b,c=1,d="",e="";for(var f in arrCondTran)d!=arrCondTran[f].PTransCondCat.Nombre&&(d=arrCondTran[f].PTransCondCat.Nombre,a='<tr class="header_cat_cond"><td style="font-weight: bold;">'+d+'</td><td style="font-weight: bold;">SÃ­</td><td style="font-weight: bold;">No</td></tr>',e+=a),a='<tr id="condTr_'+arrCondTran[f].Id+'">',b="<td>",b+=arrCondTran[f].Nombre,b+="</td>",a+=b,b='<td><input name="name_'+arrCondTran[f].Id+'" type="radio" value="1" /></td>',a+=b,b='<td><input name="name_'+arrCondTran[f].Id+'" type="radio" value="0" /></td>',a+=b,e+=a,c++;x$("#tbody_condiciones").html(e)}function b(a){for(var b=0;b<arrTipoTransporte.length;b++)arrTipoTransporte[b].Id==a&&(x$("#txt_placa").attr("value",arrTipoTransporte[b].Requiere_placa?"":"N.A."),x$("#txt_caja").attr("value",arrTipoTransporte[b].Requiere_caja?"":"N.A."),x$("#txt_caja1").attr("value",arrTipoTransporte[b].Requiere_caja1?"":"N.A."),x$("#txt_caja2").attr("value",arrTipoTransporte[b].Requiere_caja2?"":"N.A."))}function c(){a(),Common.fillDropDownList("ddl_tipovehiculo",arrTipoTransporte),b(arrTipoTransporte[0].Id),l=new InputSearch({content:"searchData",maskDataSearch:"ordencarga",txtPlaceHolder:"Orden de Carga",clickBtnSearch:e,callbackBtnSearch:function(a){d(a)},functionModel:OperationModel.getOrdenCargaByFolio}),Common.fillDropDownList(ddlVigilante,arrVigilantes),i(),j(),k()}function d(a){x$("#txt_fecha_carga_db").attr("value",a.PSalidaTrafico.Fecha_carga_solicitada.replace("T00:00:00","")),x$("#txt_hora_carga_db").attr("value",a.PSalidaTrafico.Hora_carga_solicitada),x$("#txt_fecha_cita_db").attr("value",a.PSalidaTrafico.Fecha_cita.replace("T00:00:00","")),x$("#txt_hora_cita_db").attr("value",a.PSalidaTrafico.Hora_cita),x$("#txt_linea_transporte_db").attr("value",a.PSalidaTrafico.Transporte),document.getElementById("ddl_tipovehiculo").value=a.PSalidaTrafico.Id_transporte_tipo_cita,x$("#ddl_tipovehiculo").fire("change")}function e(){x$("#txt_fecha_carga_db").attr("value",""),x$("#txt_hora_carga_db").attr("value",""),x$("#txt_fecha_cita_db").attr("value",""),x$("#txt_hora_cita_db").attr("value",""),x$("#txt_linea_transporte_db").attr("value",""),x$("#txt_tipo_transporte_db").attr("value",""),arrLstAudUniFiles=[],x$("#evidencias").html("")}function f(a){var b=a.getAttribute("id").split("_")[1];index=-1;for(var c=0,d=arrLstAudUniFiles.length;c<d;c++)if(arrLstAudUniFiles[c].Id==b){index=c;break}if(index!==-1){arrLstAudUniFiles.splice(index,1);var e=document.getElementById("evidencias");e.removeChild(a)}}function g(a){var b='<img class="pure-img" src="data:image/jpeg;base64,'+a+'" >';x$("#evidencias").html("top",'<div id="photo_'+m+'" class="pure-u-1-2"><div class="l-box">'+b+"</div></div>"),x$("#photo_"+m).on("click",function(){f(this)});var c=new BeanSalida_aud_uni_files(m,a);arrLstAudUniFiles.push(c),m++}function h(){try{var a=new MyRequestsCompleted({numRequest:3,singleCallback:function(){Common.loadAjax(!1),c()}});0==arrCondTran.length||0==arrVigilantes||0==arrTipoTransporte.length?(Common.loadAjax(!0),0==arrCondTran.length?CatalogosModel.TransporteCondicionesGetLst(1,!1,!0,function(b){arrCondTran=b.PLstTransporte_condicion,a.requestComplete(!0)}):a.requestComplete(!0),0==arrTipoTransporte.length?CatalogosModel.TipoTransporteGetLst(function(b){arrTipoTransporte=b,a.requestComplete(!0)}):a.requestComplete(!0),0==arrVigilantes.length?CatalogosModel.vigilanteGetLst(function(b){arrVigilantes=b,a.requestComplete(!0)}):a.requestComplete(!0)):c()}catch(a){alert("Embauduni:init: "+a)}}function i(){x$("#btn_capturePhoto").on("click",function(){try{Common.capturePhoto(g)}catch(a){alert(a)}})}function j(){x$("#ddl_tipovehiculo").on("change",function(){var a=this.value;b(this.value),x$("#txt_tipovehiculo").attr("value",a)})}function k(){x$("#btn_save").on("click",function(){Common.setEstatusBtn("btn_save","Guardando",!0);try{var a=document.getElementById("ddl_vigilante"),b=new BeanSalida_aud_uni(1*x$("#h_id_dato").attr("value"),1*document.getElementById("ddl_tipovehiculo").value,String(x$("#h_txt_dato").attr("value")),String(x$("#txt_operador").attr("value")),String(x$("#txt_placa").attr("value")),String(x$("#txt_caja").attr("value")),String(x$("#txt_caja1").attr("value")),String(x$("#txt_caja2").attr("value")),String(x$("#txt_sello").attr("value")),document.getElementById("txt_relato").value,a.options[a.selectedIndex].text,arrLstAudUniFiles);OperationModel.salidaAudUniAdd(b,function(a){"object"==typeof a?(Common.notificaRegExitoso(),window.open(urlHandler+"rpt/salidas_aud/"+a.Referencia+"/"+a.prefixImg+"casc028.pdf?"+(new Date).getTime(),"_system","location=yes")):alert(a),Common.setEstatusBtn("btn_save","Guardar",!1),e()})}catch(a){alert(a)}})}this.Init=h;var l,m=1};